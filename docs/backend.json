{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the investment app.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "riskProfile": {
          "type": "string",
          "description": "The user's risk profile (e.g., Conservative, Moderate, Aggressive).",
          "format": "string"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Investment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Investment",
      "type": "object",
      "description": "Represents an investment asset.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the investment."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Investment)"
        },
        "name": {
          "type": "string",
          "description": "Name of the investment."
        },
        "type": {
          "type": "string",
          "description": "Type of investment (e.g., Stock, FII, Fixed Income, Crypto, ETF, Pension, Cash)."
        },
        "purchaseDate": {
          "type": "string",
          "description": "Date the investment was purchased.",
          "format": "date-time"
        },
        "purchasePrice": {
          "type": "number",
          "description": "Price at which the investment was purchased."
        },
        "quantity": {
          "type": "number",
          "description": "Number of units purchased."
        },
        "brokerage": {
          "type": "string",
          "description": "Name of the brokerage used for the investment."
        },
        "notes": {
          "type": "string",
          "description": "Optional notes about the investment."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "type",
        "purchaseDate",
        "purchasePrice",
        "quantity",
        "brokerage"
      ]
    },
    "Alert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Alert",
      "type": "object",
      "description": "Represents an alert for the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the alert."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Alert)"
        },
        "type": {
          "type": "string",
          "description": "Type of alert (e.g., Volatility, Concentration, Opportunity, Maturity)."
        },
        "message": {
          "type": "string",
          "description": "The alert message."
        },
        "date": {
          "type": "string",
          "description": "Date the alert was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "type",
        "message",
        "date"
      ]
    },
    "Snapshot": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Snapshot",
      "type": "object",
      "description": "Represents a snapshot of the user's portfolio at a specific point in time.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the snapshot."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Snapshot)"
        },
        "date": {
          "type": "string",
          "description": "Date and time the snapshot was taken.",
          "format": "date-time"
        },
        "portfolioAllocation": {
          "type": "string",
          "description": "JSON string representing the portfolio allocation by category."
        },
        "totalValue": {
          "type": "number",
          "description": "Total value of the portfolio at the time of the snapshot."
        }
      },
      "required": [
        "id",
        "userId",
        "date",
        "portfolioAllocation",
        "totalValue"
      ]
    }
  },
  "auth": {
    "providers": [
      "google"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Access is restricted to the user themselves.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/investments/{investmentId}",
        "definition": {
          "entityName": "Investment",
          "schema": {
            "$ref": "#/backend/entities/Investment"
          },
          "description": "Stores investment data for each user. Path-based ownership guarantees that only the user can access their investments.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "investmentId",
              "description": "The unique identifier of the investment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/alerts/{alertId}",
        "definition": {
          "entityName": "Alert",
          "schema": {
            "$ref": "#/backend/entities/Alert"
          },
          "description": "Stores alerts specific to each user. Path-based ownership restricts access to the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "alertId",
              "description": "The unique identifier of the alert."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/snapshots/{snapshotId}",
        "definition": {
          "entityName": "Snapshot",
          "schema": {
            "$ref": "#/backend/entities/Snapshot"
          },
          "description": "Stores portfolio snapshots for each user, enabling historical tracking of investment performance. Path-based ownership provides secure access.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "snapshotId",
              "description": "The unique identifier of the snapshot."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be secure, scalable, and easily debuggable, following the principles of Authorization Independence, Clarity of Intent, and DBAC. It leverages path-based ownership for private user data and denormalization to avoid `get()` calls in security rules.\n\n*   **/users/{userId}**: Stores user profiles. Access is restricted to the user themselves, ensuring data privacy.\n*   **/users/{userId}/investments/{investmentId}**: Stores investment data for each user. Path-based ownership guarantees that only the user can access their investments. This structure ensures Authorization Independence, as access control is determined solely by the document path, without needing to check parent document attributes.\n*   **/users/{userId}/alerts/{alertId}**: Stores alerts specific to each user. Again, path-based ownership restricts access to the user.\n*   **/users/{userId}/snapshots/{snapshotId}**: Stores portfolio snapshots for each user, enabling historical tracking of investment performance. Path-based ownership provides secure access.\n\nThis design supports QAPs by ensuring that list operations are inherently secure, as each collection is scoped to a single user. Security rules can simply verify that `request.auth.uid` matches the `userId` in the path."
  }
}
